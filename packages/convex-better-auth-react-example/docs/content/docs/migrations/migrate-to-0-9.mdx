---
title: Migrate to 0.9
description: Migrate to @convex-dev/better-auth@0.9
---

<Callout title="Breaking changes" type="error">
  This release includes breaking changes. Not following the migration steps
  correctly can lead to unexpected behavior.
</Callout>

## Upgrade component

<div className="fd-steps">

  <div className="fd-step">
    ### Install dependencies

    Update Better Auth and the component.

    ```npm
    npm install @convex-dev/better-auth@0.9
    npm install better-auth@1.3.27 --save-exact
    ```

  </div>

  <div className="fd-step">

### Regenerate schema (Local Install only)

Whenever updating Better Auth w/ Local Install, regenerate the schema.

```npm
cd convex/betterAuth
npx @better-auth/cli generate -y
```

</div>

  <div className="fd-step">

### Update `onUpdate` triggers

<Callout title="Breaking change!" type="warning" />

Any triggers using the `onUpdate` hook should be updated to expect the new
doc as the second parameter, and the old doc as the third parameter. The old
doc parameter can be left out of the signature if not needed.

```ts title="convex/auth.ts"
export const authComponent = createClient<DataModel>(components.betterAuth, {
  authFunctions,
  triggers: {
    user: {
      onUpdate: async (ctx, oldDoc, newDoc) => { // [!code --]
      onUpdate: async (ctx, newDoc, oldDoc) => { // [!code ++]
        // oldDoc can be left out of the signature if not needed
      },
    },
  },
});
```

  </div>

  <div className="fd-step">

    ### Use `_id` in database adapter

This isn't technically breaking since the database adapter api is not a part of
the documented api surface, but any adapter usage referencing the `id` field
should be updated to use `_id` instead.

<Callout type="warning">
  Using the adapter directly is not unsafe, but it is not recommended. Results
  are not typesafe, and breaking changes may occur.
</Callout>

    ```ts title="convex/auth.ts"
    export const getUserById = query({
      args: { authId: v.string() },
      handler: async (ctx, args) => {
        const user = await ctx.runQuery(components.betterAuth.adapter.findOne, {
          model: "user",
          where: [{ field: "id", value: args.authId }], // [!code --]
          where: [{ field: "_id", value: args.authId }], // [!code ++]
        });
        return user;
      },
    });
    ```

  </div>

<div className="fd-step">

### Migrate away from `user.userId` support

**This step is not required for 0.9, but will be required in a future release.**

Storing your app user id in the Better Auth user table is no longer required,
and built in support for it is deprecated.

<Cards>
  <Card title="Migration guide" href="/migrations/migrate-userid">
    Migrate away from `user.userId` support
  </Card>
</Cards>

</div>

</div>
